---
title: "MAN IN THE MIDDLE ATTACK"
layout: post
---


**1. Giao thức ARP**

Đây là một giao thức mạng dùng để tìm ra địa chỉ MAC của một thiết bị từ một IP nguồn.
VD: Thiết bị sẽ gửi 1 ARP request chưa IP của thiết bị nhận. Tất cả các mạng trong local network sẽ nhận đc gói tin nhưng chỉ có thiết bị khớp với IP trong gói ARP mới có thể phản hồi lại thông tin với thông điệp chứa địa chỉ MAC của nó.

**2. ARP Spoofing**

![ARP SPOOFING DIAGRAM](https://dsm01pap003files.storage.live.com/y4mF4Cj0m0f88khpHqP9g5cE9dUjUv3O8uMex1DlpNnTBfCrvZs3Jwp-wh9GYsOTdr_PwLvsiuh-Ooa2X-0obMbBl-6Uct0YWsvsaAxCiEz1vAb48IyOJJ-dWn-vI7O2DYY7AxfN7QQzGDb3Mnh6qwQhWEaWQCG_TzD_R0ybvqgV9rgLO6bczPm4-L8Ey9sA5ZrUVhOEtP9OrYuLfRtHHeY00yXBfph61Kv3gghUXQof20?width=570&height=295&cropmode=center)

ARP Spoofing cho phép chuyển hướng các packet cho nên thay vì các packet được gửi thẳng đến máy victim (như sơ đồ), nó sẽ đi qua máy tính của hacker. Như vậy các request cũng như respond sẽ đều phải đi qua máy tính của hacker → Cho phép hacker đọc, chỉnh sửa cũng như chặn các gói tin này.

**3. ARPSPOOF Tool**

Máy thực hiện tấn công: Kali linux 2022
Máy mục tiêu: Windows 10
Để hiển thị bảng dữ liệu arp, chúng ta sử dụng lệnh: arp -a


![arp-a command](https://dsm01pap003files.storage.live.com/y4mmbreHb3jLMQUv_VbUu8qTytNZrJiLXlc8GGAc4ZLswe5m0Sc8YpBjjsxXaxtTLLBrKE2tNZlMTxCNaBhxvJ0MO7sIZoEOOGgnTFZZRGnnc7zEsl3mz_JESvaLZAkkFalQVPVlSfaE7UnjXGziE9ADuLF6ToxDwWrVql9BGhemdBpJ1Aja3abAXeHiZi-LWdgUg4tBNzoKEigjzZ4Vf6W4v082UjZVnh_jPKL5ts6U9U?encodeFailures=1&width=622&height=99)

Sử dụng arpspoof:
**arpspoof -i [name_interface] -t [IP_victim] [IP_gateway]**: Gửi request đến máy nạn nhân nói rằng mình là router

**arpspoof -i [name_interface] -t [IP_victim] [IP_gateway]** Gửi request đến router nói rằng mình là máy victim

![Thực hiện chạy đồng thời](https://dsm01pap003files.storage.live.com/y4mp7nXvbDiG7iL79j6b6-xYkLCXkNGyniUPj9-I3J7GC3cbMFeoBoGvYjOCAEAIK4GnUatWlVKJ8MiP4fUNNtf11DuqzsOb4XE6GCfn7uKAAW0WqaTmQWe0ExBhVBhMsltOtKQ-rqlFZ1EicJP2G9r-NJrhXbief0_iwnhobdzGh7ND5p2ZQWpYYCk4ZzORhAtguJT1HinI8--lwwzX-FODy6VXVPDcIgnN6-M2zvWHyw?encodeFailures=1&width=622&height=225)


![Kết quả bảng arp máy windows 10](https://dsm01pap003files.storage.live.com/y4mGx4BSzVSE2MNv5fsftE8kJ_UX_t_1RvXI2Dh4_1wvv5JftoZsHK4bAyPehrm8aJTcdtyduYSr3OCFAx9KR24iBijghpB4R4tv6WQR8cB3u6K0dkpicbr-rNYIBz1rKQbWc4OghcmFKxagf-yOQoxQmt4mjP1NL7GUPYF0SDIdvTd1y2oc7moLBguP72Yr1EBn_fWPnbn_Fj-9LrUhB07vaprFlUPY_x4MKLUJXwl_mE?encodeFailures=1&width=561&height=327)

Vì kali linux không phải router nên khi có request nó sẽ không cho những request này qua và chặn chúng lại( tính năng của kali). Vì vậy để những request này đến router chúng ta phải mở cổng chuyển tiếp giống như 1 bộ định tuyến

![ip-forwarder](https://dsm01pap003files.storage.live.com/y4m6cq5Wuj7nNlM_9GnYxDw9DmcnmVIAhnkAOkSvQH_HDLNykDcrqrfye7BaVwRBwbMrhzv5zftqT-ezfU8hBQvmA6UxjygqyRR0tSZhL2ZyCWa3fhD4P3adJhedpkkjy-f02u_xgnGr-tcVL94D1SwcayDkq3Nwvs_4Uvl7x7ILjqrZUO60gRUV2ccp6v0-hjXOqKnDncSxYff3WEt8AyrNVxZmZobU-Ww35TJe6_vtcE?encodeFailures=1&width=444&height=82)

**ARP Spoofing using Bettercap**

Đây là một framework để tấn công mạng
Nó có thể được dùng cho:
- ARP Spoof ( chuyển hướng các packet)
- Sniff data
- Bypass HTTPS
- DNS Spoofing
- Inject code in loaded pages
- Nhiều cái khác nữa

*Thực hành*
Khởi động bettercap: **bettercap -iface [name_interface_network]**

![Khởi động bettercap](https://dsm01pap003files.storage.live.com/y4mn5PxTqiiSL-EGqTGjCbgh0RUunlGcAuX9hi5D-CVOetujyhQUjjX6FiP35Hfi5pkivZT9DqqAJZx68oD5yUx1X3jtzK6BxmMdyzwxyZwWflr7R80xRpDOTm5FS2J1Od0bwLm0YFAlxNCZdDYIDWbi6mp9EmkhbTIotx4-feVZy6PIxHetzT1BlUCNoDvnhFYq8IEna5nJYVlSetFHxv87Ww6NjzMkYizkM8qiZAVVL8?encodeFailures=1&width=623&height=208)

Có thể dùng lệnh **help** để xem tất cả những command có thể dùng với bettercap

Bettercap có những modules chúng ta có thể dùng, ở chế độ mặc định thì có module **events.stream** đang được chạy ngầm để handle tất cả các events

![4-ành](https://dsm01pap003files.storage.live.com/y4mTZRE7Ajw1kekpvlj_JtNT__U9CoQgwZKvBqqUhec4e2MfC_S4lKl-re1mJad8OBHBOEcLixBIcc9fJ0x7ma89hfrqxjnppAgJVldM9M0QsNDxrhQeUvOI10DhVM4Sxmr9dz04tllsAKw03YetHvbSQ8xiO88Sq4REALFiSXQXLafTiI6frxrZsqtfm7mu1xmqgENX3V2uauC4nJuJHJX8hpbHrbZiqKzHGcY3suxX0o?encodeFailures=1&width=245&height=322)

Ở đây chúng ta sẽ sử dụng modules **net.probe**. Module này được sử dụng để gửi các gói UDP để tìm ra các thiết bị mạng trong local network

Start net.probe: **net.probe on**

![4-anh 4](https://dsm01pap003files.storage.live.com/y4mjw7dqDTOMBBUBZC_PnES3R9QBPVdC-RRUrFmu7nrOr_k4LH3AMNfkdEYzGD_zKrzFTfBImnPwj0vPiuCyWmXK_i3oFo7qbq5-Bl9-MjP2FRjhNzxDAtiJylpuXO1VLIgBP3oM0sqbiu-NUZ753qKL8XkdxqUkFnf9a-o6q9Z38SpIl3sNee4JuDLIR-TBUKYutXMrZUBukdBhJRAidAImVpNnojxBDmoqfHzlTltJU0?encodeFailures=1&width=628&height=154)

Có thể thấy ip 192.168.245.133 là ip của máy windows 10 mà chúng ta đã sử dụng ở phần trên.

Khi start net.probe, net.recon sẽ tự động start. Net.probe gửi request đến tất các các ip trong mạng và khi có respond, net.recon sẽ phát hiện respond bằng cách theo dõi arp cache và sau đó thêm những IP này vào 1 danh sách để ta có thể nhắm vào tấn công.

Thực hiện lệnh: **net.show** để xem tất cả các thiết bị được kết nối

![4-anh 4](https://dsm01pap003files.storage.live.com/y4mxQXSIr3u9sin7WujMAjdwdgbDQUZeo8b8K9ZnFDmP2ymnF263A8SSTXbnCGMcymwq1GZt0RkQt3jy5mA-_c_6gkuXLE7hQIMCgn3wXyLteZeaSGygks_IvdB3VGzQx5g9BUKoBY1qNsCmtR_YFTFmJfPoB1EpqEaZLOyZq83HpHr3UKWIPNbCcHF7n1sAhqMhJf6biNQvWjFzsl_SAvohT_9Vo3LCj53npnk6c_GF2w?encodeFailures=1&width=624&height=187)

Tiếp theo, chúng ta cần trở thành **Man in the middle**, ở đây sẽ sử dụng module **arp.spoof** 

Trước khi start arp.spoof, chúng ta cần thiết lập lại một số thành phần trong module arp.spoof

Thứ nhất, **set arp.spoof.fullduplex true**, hiểu đơn giản là sẽ spoof cả router và máy victim như chúng ta đã thực hiện ở phần trên với arp spoofing tool. Ở mặc định thì biến này sẽ được gán là false và nó sẽ chỉ spoof target machine

Thứ hai, set **arp.spoof.targets [IP_victim_machine]**

Cuối cùng, start arp.spoof 


![4-anh5](https://dsm01pap003files.storage.live.com/y4mkcGuguuBvKzpDKWMGvPI6j4oclWqiA6UfwTDQaLL24s2BvW4iM_TOoRidfcaGXVPJNdE4aYTNSfVm_z5GuG84YcCGir1o2dC5Idr4GYlPNLSiE88KXYpoO_MJ5BENyZTtPky9Zua0iKphmlebTmaKmIB_pELOSF8BrWha-Chnq39ZNDXd7hX61QQoD21Eo2zhTPt358nhIS9y9tRSYy-c8fx7mUIJaRQlK4uymOMm_A?encodeFailures=1&width=623&height=183)


Sau khi hoàn thành, kiểm tra lại máy windows 10 sẽ được kết quả:


![4-anh6](https://dsm01pap003files.storage.live.com/y4m3B1xreTr9vZ-hylPm_Qx6zXLI79jfdLw2mMNibhK6WZXEgZVK8VZwuDFBbgg0w5szK3JPZa_FZzG4k-uY32oCrOVQ2Iy6QaaU7WE52KHsAQQ7JngxUhUrU147dnsA1B5YAEWphlE-Vq7MU7fEQgn4IuoVFz6wuw8531uDbz1XMs3y7xxagqRaWTvP4bnOxwNi7uOT0Nk12-Q11XlT5qoxLd3RfAKTd2UmuuPPbve4RM?encodeFailures=1&width=501&height=222)


Có thể thấy địa chỉ MAC của router sẽ giống với địa chỉ MAC của IP: 192.168.245.132 (là địa chỉ của máy kali). 


**5. Sniff data**

Trong bettercap, sử dụng module **net.sniff** 

Khởi động net.sniff: **net.sniff on**

Truy cập web browser trong windows 10. Ở đây chúng ta sẽ truy cập vào một trang web (http://testphp.vulnweb.com/)


![5](https://dsm01pap003files.storage.live.com/y4mFVUvFMrqSnxynfAQ3EeNWMQipFsiJKyCvDGBFDeC9wmjpXJ-HM9pderVuqjVqTRmVQBdeXPbT5ZqXKfbrTSfVQInAWUS4FRg8c5TAiccKU00dmHHEBy0kNRZ0InyvTE6Df-vOQn5lSAsFJf_L-qwUXvWp6X5RUpsbzoZbE6DMUVkZjXAop1rLj_XkNUtPhLolsfWFMzNbyo-mQ1JmxOH7CMgwJ5n32zmQH50HD9E9B8?encodeFailures=1&width=626&height=336)


Có thể thấy ở đây máy nạn nhân đã truy cập đến trang web **test.vulweb.com**

Tiếp theo hãy thử bắt username và password mà nạn nhân đăng nhập vào trang web trên

![5-2](https://dsm01pap003files.storage.live.com/y4mfWmCADO1HdR-m2tG4ncigjL2-RDH7yVX7YzklS86jtS78_bREH4o_SbvDinQrfJ2AcWpo8RI10CTKfne9at_Kb9qQZTmtPO6PlPbRldw8Dm_L9eUOG9qR0w3Jp0S0Nh03iAmoFXnLOdrmu5e1Uf8hCZLo0tUJGWMYUz0HA0A6JazyQ8ZkiAzhjYs_LRCrYU7zEx-7VAG3AB9mHg9abZRF_r-y9Pfg1AbNqo4M3QzkCw?encodeFailures=1&width=627&height=173)


Kết quả là ta đã bắt được username và password.

**6. Create custom spoofing script**

Có thể sử dụng caplet để làm các bước ở phần 4 và 5 một cách tự động

Caplet là một tệp văn bản bao gồm các câu lệnh mà bạn sử dụng để tấn công man in the middle attack

Thực hiện: Tạo một file văn bản và viết ra những câu lệnh sẽ sử dụng


![6-1](https://dsm01pap003files.storage.live.com/y4mV7gmSEVmgSgfsEdmV64dsl7QW0R8AjluCeYO6vLc95b15ov63rq-j1tLrwYn1XyBRbYQNp3ioHAAz50OBAwkQxeIlbuF20f9tBrKEmQ55upEF8lEmzKT1G179oY8N4vqxfq2_pivpxDSurQdVz6ANas6G-7mlNrQNbL9LUSpbnWErVtZB3gU-QtAbhLfomLUBXBLMdyMTXFv-zk6ZTXwfxyLCApVY3i-MyVpINhhLvw?encodeFailures=1&width=388&height=103)


Tiếp theo, khởi động bettercap với caplet đã tạo: 
**bettercap -iface [network_interface] -caplet [file_path_caplet]**

![6-2](https://dsm01pap003files.storage.live.com/y4m4RDBhBqIhxtiJ7vbjDf8KNY5DKu1mPbTSCG1ikjxCCAXEGqlM-xcDyvpA1QhMM0_P5pnT89IYveFUH90Gpki97bGLHgc6o8rXgV22sQkB2m_MH459CbOIfXgpRZr-kzlnGNLGcNRiEeMiWp4yr9E4e3fLKRpQHoVNzWqXLaCJ2Pan-Wb3kb8QaZwTAlYPFcyM3Xji9n91GQOf_aEhuMdI2Qv1aWotzKw1_j5o0LkuXs?encodeFailures=1&width=625&height=435)


**7. Bypass HTTPS**

Khi sử dụng giao thức HTTP, dữ liệu được truyền đi dưới dạng plain text do đó chúng ta có thể đọc và chỉnh sửa

HTTPS đã khắc phục được điều này và hiện nay đa số các website đều sử dụng HTTPS. Về cơ bản cách HTTPS hoạt động là thêm 1 lớp layer sau HTTP và lớp bổ sung này sẽ mã hóa các văn bản thuần túy → Do đó chúng ta sẽ không thể đọc được dữ liệu

HTTPS dựa vào TLS hoặc SSL để mã hóa dữ liệu. Cách dễ dàng nhất để bypass là downgrade HTTPS thành HTTP. Nếu người dùng truy cập đến một trang web HTTPS thì chúng ta sẽ cung cấp cho người dùng một phiên bản HTTP thay vì HTTPS. Để làm được điều đó thì chúng ta sẽ sử dụng tool có tên là **SSL Strip**. Tuy nhiên cách sử dụng của SSL Strip sẽ được đề cập đến trong các bài viết sau, ở bài viết này chúng ta sẽ sử dụng những caplet có sẵn của bettercap để downgrade https to http.


Đầu tiên, chũng ta sẽ phải sửa đổi một vài câu lệnh đã viết trong caplet đã tạo ở phần 6

Trước khi khởi động **net.sniff**, hãy set giá trị cho thông số **net.sniff.local** là **true**. Option này sẽ nói với bettercap rằng sẽ sniff tất cả data kể cả local data. Khi chúng ta sử dụng caplet của bettercap để downgrade https, bettercap sẽ nghĩ rằng những dữ liệu bắt được là được gửi từ chĩnh máy chúng ta và sẽ không hiển thị trên màn hình.


![7-1](https://dsm01pap003files.storage.live.com/y4mGOZvvdV6r8BoNsRZT_BRmUcuoyOA4GDweBelJlZxGs1mqiD7kikCudCJUO7fu0Yy2wRPJ4b494z3z2FHP2jgdvvrI1ltb85av3HAGqbURuvbgJqBq4lEQmiSIUvgvsdXZpJnBq_L_BYli-rZFulTzNFQ2vSX2l1lfJ1Cp5LjzJcLSptkztDwt1txbnmZdK5vuy6cF74mV4JG44zIEFT75GXCB7zGMp1hXQFaE8jnU8U?encodeFailures=1&width=392&height=179)


Sử dụng lệnh caplets.show để hiển thị list caplet mà máy có. Caplet mà chúng ta sẽ sử dụng là **hstshijack/hstshijack**. Các bạn cũng có thể download caplet này trên mạng hoặc download tại đường link: (https://drive.google.com/file/d/19NsOnD4Obuezr0nKWbBxtngoqM_OwWKU/view?usp=share_link)

Ở máy tính nạn nhân, truy cập vào 1 trang web https VD: linkedin.com


![7-1](https://dsm01pap003files.storage.live.com/y4mla8jtXeiBnkNt0ykaAI5Xmi02AQo45pZo3FH-Pd4mrk-9BjyZdSpXYw5Ih37jFiOVa7LFxi5D2V88I71j4vtbeewRv1EYx6XfwSJrDUnLYtl6Ggi83pjpiitH83c2gQXaxwf1MHbL3rNPJN4Gr3f2Lngr2k4YkGj-8KvHPSLfblJ_C_6_pSyvh8I4SZkxFeyZczOphQKxqsBkinBzqoAm4Qf_5_sQmMbB7oXqyKw2Kc?encodeFailures=1&width=622&height=96)


Có thể thấy website hiển thị not secure là đã thành công downgrade. Sau đó thử đăng nhập với username và mật khẩu bất kỳ trong linkedin


![7-3](https://dsm01pap003files.storage.live.com/y4mfWplbYAiDuKx_N1XBI9H2yqK3f0DzFM_huwh5_ypYf9Q2KORVlJSGlHWRoljpZ5X89HP74ylWHIIaazZqDr7GhXNKHuKYfHsaT_K9Cn8A7VUmtEsRUvfyvmzdhU2ZbEXc899h0oKS8Ej8hUGgvM8IyptNyewmmRmLQ7qoBJCImMTyrMbE0qz6gbYVXIC2scfcUDNmPgExy1_xaiKYXmT5cOtwkH6Dm5eHBOojR7P5x8?encodeFailures=1&width=625&height=105)

Và cuối cùng chúng ta đã ấy được mật khẩu và password


**8. Bypass HSTS**

Một số trang web như facebook, twitter sử dụng HSTS là những trang web only-load HTTPS

Solution: Thay thế link của những trang web HSTS thành những website có đường link gần giống. VD: facebook.com → facebook.corn

Chúng ta vẫn sẽ sử dụng caplet “hstshijack” như phần 7

Đầu tiên, truy cập vào file config của caplet “hstshijack” theo đường dẫn /root/usr/local/share/bettercap/caplets/hstshijack và chỉnh sửa giống như hình dưới đây


![8-1](https://dsm01pap003files.storage.live.com/y4mLN3RSEB_elLMyWEjyV12RGIhAS1V4qyKk2e_rmwkwDzRuTqrSZoMzMoMxqpPfVo2CkF_CuJoSC6K8Ind161TV_u9uBkLc81zS9a2eAAyjyLfeCC-S7yxny0B76UIsMd5ePvjN0UqLOnr73QX-f6DmhWrOLF-y2BhY5E-DbNbRieOnP-aL30VOlzCvgdt3HgJ0CROwEhqUxf58JgzsmvxuOzvTo588nT_zWyD4ItLA_s?encodeFailures=1&width=626&height=195)


Ở đây targets sẽ là những trang web mục tiêu mà chúng ta muốn thay thế. Phần replacements sẽ là tên miền các trang web mà chúng ta sẽ thay thế vào targets. Các options obfuscate và encode để là false bởi vì một số trình duyệt như firefox sẽ chặn mã bị xáo trộn hoặc mã hóa. Tại phần payloads bạn có thể đưa vào một số javascript code để inject. Cuối cùng ở phần dns.spoof.domains cũng tương tự như phần replacements

Bắt đầu tấn công, chúng ta sẽ khởi động bettercap và sử dụng caplet “hstshijack” như đã làm ở trên

Ở máy windows 10, chúng ta sẽ không thể vào fb một cách thông thường mà phải thông qua một số search engine như google.ie


![8-2](https://dsm01pap003files.storage.live.com/y4m43vPB7YP-nXxRITa5u-DHQAkh6E_wQUAG2Sn5BiUeuWt0FawKS4SNX7237mO1MgQzcOml-zMlDoYUAeIbpIS_Cl9TNyR8GjjS55lTx9gsynJP6rLRko4i6HdPHmDuSqyldg6To_v7XnEhD_At75X7jUZirisN5AkXQOYvas6Rd_6qUqRwqcbg8dUgfStI6St7c_l7vWj8y4_QnAFrXVWiHmwZpbYIIcI1yYb9V_B3nA?encodeFailures=1&width=447&height=103)


Chúng ta sẽ thấy hiện not secure và khi người dùng search facebook vào ô tìm kiếm trên google.ie thì đoạn script mà chúng ta chèn vào trong caplet hstshijack sẽ chạy ngầm và tự động thay thế tất cả các link facebook.com được tìm kiếm thành link replacements là facebook.corn


![8-3](https://dsm01pap003files.storage.live.com/y4msNAcO7aiPvi2vIR94KepyfuYVNKjudsFffYDADza65MnN9cndHTzqF-j64XzsBb7o7pEfNUM8mb3jDtSEL88JN6MjzSSFtAnNQB1fENEUI1-XNqqbr3QJSPy6dTSxFCSuBfK-1PE0q9ffStQqnoEkGw0TizjWB2QppFWZi5VFuWMw2fO6Tr6m7EyHymmCekwdHrIb-xJPoPwECYpO1aPZnHtpCv-Q4s1wofhD9syrCw?encodeFailures=1&width=613&height=483)


Và khi nhấn vào link tìm kiếm chúng ta sẽ được kết quả


![8-4](https://dsm01pap003files.storage.live.com/y4mcJMGdYCEox_Q2EO8tf5E3QiIpJWsQdZtDh8fZBoxiB3Us1W_IDoORy9KSVUZoGLOZPzzJtQVPnC9uai4ptVWNDSHp6hHXeMS9m0AwNwVy65UYU54Lk_0SlameCRbI_4eLK5iIleDVMU1wrahh4wc7qy0jXnb8npShINT4tf1N5bmgH2S9kJCLWwq5afeQvboQ4KCWknvlmtYxwHZfslN15QwPbeWLhW8pMqhQvvXTbg?encodeFailures=1&width=626&height=66)


Làm theo hướng dẫn như phần 7 chúng ta có thể lấy được username và password của facebook.


**So sánh bypass HSTS firefox và chrome**


![8-5](https://dsm01pap003files.storage.live.com/y4mlnJfwILa3boJbxHu_6SBJb54QmNQb1-RTQvx-dS8xXZrXlmqpn9eUS5-twTvgrBRxXvTfRRqONkAeqBwFOLO47onzd8M0YFjD6a0jKdvHMeZSmtxlVtYCSDGfU43OfPU1ai9LTpKsVOZ33U1x61je5rFYkJh2KG2RIFaF2rpvVpMqJBhyaVMhgaDElS7yfriXFIBHK9Gonylq2pnYOhEwgMkQK9z94aAuAZuNZF0ZRM?encodeFailures=1&width=624&height=310)


**9. DNS Spoofing**


Như chúng ta đã biết, DNS có nhiệm vụ convert domain name ví dụ như google.com thành IP hosing. 

Khi tấn công man in the middle, request sẽ không được gửi thẳng đến DNS server mà sẽ thông qua chúng ta vì vậy chúng ta có thể respond bất kỳ IP nào mà chúng ta muốn. Chúng ta có thể điều hướng đến một trang web giả mạo… 

Ở phần này, chúng ta sẽ điều hướng user đến trang web của chúng ta (apache2 server có sẵn trên kali)


Khởi động bettercap như bình thường với caplet chúng ta đã tạo ở những phần trước. Chúng ta sẽ dùng module **dns.spoof**. 
**Set dns.spoof.address: [IP_kali]**
**Set dns.spoof.all true** → Respond đối với tất cả các DNS Request
**Set dns.spoof.domains [domain_name]**

Ví dụ ở đây chúng ta sẽ set domains là linkedin.com

Cuối cùng khởi dộng dns.spoof: **dns.spoof on**


![9-1](https://dsm01pap003files.storage.live.com/y4mQWnKFnzsV4d8Fdtw0OBHCAaDQFMtDjs_lTAMd7uo6riDU7q_mydfnOwZD_T4jE6SUSwxmk7-XDfDgaYHCuiZ1PEUJayu-pE1Bvvdf_yykxvdyxumE3brEO8YXbppptGDKfLeImyKKXimmqLuq-vwsMINW2mX9QztT5R6bfqWfPBQ3rTKWCPQdSOJYPbksoDunbihlHanBRtwPkRYZEob8mk0B1uQAYPsPxWPxY62Sjk?encodeFailures=1&width=544&height=120)


Có thể thấy khi chúng ta truy cập đến tên miền linkedin.com thì sẽ tự động chuyển hướng đến apache2 server.


**10. Injecting javascript code**


Về phần này, hiểu đơn giản là chúng ta sẽ chèn một đoạn code bất kỳ mà chúng ta muốn và trình duyệt sẽ thực thi đoạn mã đó

Ở đây chúng ta sẽ thực hiện một đoạn javascript đơn giản có chức năng hiển thị thông báo


![101](https://dsm01pap003files.storage.live.com/y4mD9MUsfbXtLha6zZm40OqWBcADi6OwcImA7vDT25OEp6TQ_ygK3EJ996LHzDLh4v8i_VJlTmofLR6xGFRGTobSkVRD8yasI9quCD7lObRRBQUdcq62D22-YyFh6zMq6FwTj-TERoTHsscxXHoYok0Lm4NJfqTQT-b8Q68z7ImQxpgjRQyIZrZugOLLJ7GzHjlKv-Puj38Qdl9GdlV_x8eZMxgZNUlx3xMLif8M4LTMOc?encodeFailures=1&width=240&height=89)


Chúng ta vẫn sẽ tiếp tục sử dụng caplet **hstshijack**. Truy cập vào đường dẫn **/root/usr/local/share/bettercap/caplets/hstshijack** để hiển thị file config. Thêm domains name và đường dẫn của file javascript vào phần set hstshijack.


![102](https://dsm01pap003files.storage.live.com/y4m1nUlaYoIGxZSpPt8mzy2nBTwrbjGoxfRUszCYtSoSvMsB5ZpEw9Xdjp9DDjC8H80dZs8Op-3eoQaV6oXA-_wp3eKc1onOfEVsfSa3Q03jNenWJAlAWDx38IzwaPSDBsNrU_ov8TeraxCR-wvY38TpkxQ8aoFStq4lbltW7NwtYhhopL_Eo-Tg_R9y8015dNuk-qUBUti-cYnDxm_OhhsTY0Y285f-Ip8UcF7Fcn_lZM?encodeFailures=1&width=626&height=186)


Như ở đây, mình để * tượng trưng cho tất cả các trang web và đường dẫn file là /root/alert.js

Tiếp theo, khởi động bettercap và sử dụng caplet **hstshijack** như các phần trên

Ở máy windows 10 khi truy cập vào các website https sẽ hiển thị thông báo

Chú ý:  Các website HSTS sẽ không hiệu quả bởi vì chúng only-loaded https nên chúng ta sẽ không thể inject code


![103](https://dsm01pap003files.storage.live.com/y4mCRHw3ZFoTf0iV7IThzjkoXTdY2U2W2bmkfVBNd4mSmgK0QTpq0x6ZSmDNHbVOdee1mZ2wADxUKw6aclMUqlCvfFpII6NY3Th2pUbIxnTY8y1lNkTxbBy8X1pqzr9BEnrwW7OOCcmG2pghMC1L2ovV1N9Fhrb6_xXIiaBW2g5u6Okh5QoB6XMgGjBsdYf5eJosYsEDkRc82_ZWFxz5yRUUobomWVv5pCt2wRprwUWj5Y?encodeFailures=1&width=626&height=175)
















